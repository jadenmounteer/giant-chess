<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <link rel="icon" href="/favicon.ico" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta
      name="description"
      content="Web site created using create-snowpack-app"
    />
    <link rel="stylesheet" type="text/css" href="/index.css" />
    <title>♟️ Giant Chess</title>
    <script src="https://aframe.io/releases/1.6.0/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/c-frame/aframe-extras@7.4.0/dist/aframe-extras.min.js"></script>
  </head>
  <body>
    <noscript>You need to enable JavaScript to run this app.</noscript>
    <script type="module" src="/dist/index.js"></script>

    <div id="joystick">
      <div id="joystick-handle"></div>
    </div>

    <a-scene renderer="colorManagement: true">
      <a-assets>
        <a-asset-item id="chess" src="assets/chess-board.glb"></a-asset-item>
      </a-assets>
      <a-entity
        light="color: #EEE; intensity: 1.27"
        position="0.82504 4.32177 1.14829"
      ></a-entity>

      <a-entity
        id="chess-entity"
        gltf-model="assets/chess-board.glb"
        position="2.73302 -0.07189 -4.57547"
        scale="0.5 0.5 0.5"
      ></a-entity>

      <a-sky color="#ECECEC" opacity="0"></a-sky>

      <!-- Add a camera with look-controls and wasd-controls -->
      <a-camera id="camera" position="0 1.6 0"> </a-camera>
    </a-scene>

    <script>
      const joystick = document.getElementById('joystick');
      const handle = document.getElementById('joystick-handle');
      let isDragging = false;
      let startX, startY;

      joystick.addEventListener('touchstart', function (e) {
        isDragging = true;
        const touch = e.touches[0];
        startX = touch.clientX;
        startY = touch.clientY;
      });

      document.addEventListener('touchmove', function (e) {
        if (!isDragging) return;
        const touch = e.touches[0];
        const deltaX = touch.clientX - startX;
        const deltaY = touch.clientY - startY;
        const distance = Math.sqrt(deltaX * deltaX + deltaY * deltaY);
        const maxDistance = 50; // Maximum distance the joystick handle can move
        const angle = Math.atan2(deltaY, deltaX);

        // Limit the handle movement to the maximum distance
        const limitedDistance = Math.min(distance, maxDistance);
        const limitedX = Math.cos(angle) * limitedDistance;
        const limitedY = Math.sin(angle) * limitedDistance;

        handle.style.transform = `translate(${limitedX}px, ${limitedY}px)`;

        // Update camera position based on joystick input
        const camera = document.getElementById('camera');
        const position = camera.getAttribute('position');
        const direction = new THREE.Vector3();
        camera.object3D.getWorldDirection(direction);

        // Move the camera forward/backward based on the joystick's Y-axis movement
        position.x += direction.x * (limitedY / maxDistance) * 0.1; // Adjust the movement speed
        position.z += direction.z * (limitedY / maxDistance) * 0.1; // Adjust the movement speed

        // Move the camera left/right based on the joystick's X-axis movement
        const strafeDirection = new THREE.Vector3();
        strafeDirection.crossVectors(camera.object3D.up, direction).normalize();
        position.x += strafeDirection.x * (limitedX / maxDistance) * 0.1; // Adjust the movement speed
        position.z += strafeDirection.z * (limitedX / maxDistance) * 0.1; // Adjust the movement speed

        camera.setAttribute('position', position);
      });

      document.addEventListener('touchend', function () {
        isDragging = false;
        handle.style.transform = 'translate(0, 0)';
      });
    </script>
  </body>
</html>
